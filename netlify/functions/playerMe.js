const{json,loadState}=require("./_state");const{loadAuth,sha256,playerTokenFromHeader}=require("./_auth");exports.handler=async(event)=>{try{const t=playerTokenFromHeader(event);if(!t)return json(401,{error:"Missing token"});const state=await loadState();const auth=await loadAuth();const tokenHash=sha256(t);let playerId=null;for(const [pid,rec] of Object.entries(auth.players ||{})){if(rec && rec.tokenHash===tokenHash){playerId=pid;break;}}if(!playerId)return json(401,{error:"Invalid token"});const p=(state.players || []).find(x=>x.id===playerId);if(!p)return json(404,{error:"Player not found"});return json(200,{ok:true,player:{id:p.id,name:p.name,teamId:p.teamId||null,status:p.status||"alive",kills:p.kills||0}});}catch(e){console.error("playerMe failed:",e);return json(500,{error:"Failed",detail:e?.message || "unknown"});}};