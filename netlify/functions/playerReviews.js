const{json}=require("./_state");const{loadAuth,loadReviews,sha256,playerTokenFromHeader}=require("./_auth");exports.handler=async(event)=>{try{const t=playerTokenFromHeader(event);if(!t)return json(401,{error:"Missing token"});const auth=await loadAuth();const tokenHash=sha256(t);let playerId=null;for(const [pid,rec] of Object.entries(auth.players ||{})){if(rec && rec.tokenHash===tokenHash){playerId=pid;break;}}if(!playerId)return json(401,{error:"Invalid token"});const reviews=await loadReviews();const items=(reviews.items || []).filter(x=>x.playerId===playerId).slice(-50).reverse().map(x=>({id:x.id,title:x.title,status:x.status,ts:x.ts,adminNote:x.adminNote||""}));return json(200,{ok:true,items});}catch(e){console.error("playerReviews failed:",e);return json(500,{error:"Failed",detail:e?.message || "unknown"});}};