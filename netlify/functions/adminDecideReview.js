const{json,isAdmin}=require("./_state");const {isAdminAuthed}=require("./_adminGuard");const{loadReviews,saveReviews}=require("./_auth");exports.handler=async(event)=>{try{if(!(await isAdminAuthed(event,isAdmin)))return json(401,{error:"Unauthorized"});const body=JSON.parse(event.body || "{}");const id=String(body.id || "");const status=String(body.status || "pending").toLowerCase();const adminNote=String(body.adminNote || "").slice(0,240);if(!id)return json(400,{error:"Missing id"});if(!["pending","approved","denied"].includes(status))return json(400,{error:"Bad status"});const reviews=await loadReviews();const item=(reviews.items || []).find(x=>x.id===id);if(!item)return json(404,{error:"Not found"});item.status=status;item.adminNote=adminNote;item.decidedTs=new Date().toISOString();await saveReviews(reviews);return json(200,{ok:true});}catch(e){console.error("adminDecideReview failed:",e);return json(500,{error:"Failed",detail:e?.message || "unknown"});}};